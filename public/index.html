<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <title>Zeus AI - Advanced Trading Bot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 10px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 20px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            background: linear-gradient(45deg, #00d4ff, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: clamp(1.8rem, 4vw, 3rem);
            margin-bottom: 10px;
            font-weight: 800;
        }

        .header p {
            color: #a0a0a0;
            font-size: clamp(0.9rem, 2vw, 1.1rem);
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        @media (min-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (min-width: 1200px) {
            .main-grid {
                grid-template-columns: 2fr 1fr 1fr;
            }
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .ai-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 15px;
            border: 1px solid rgba(0, 212, 255, 0.3);
        }

        .ai-indicator {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: #00d4ff;
            animation: aiPulse 2s infinite;
        }

        @keyframes aiPulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 10px #00d4ff; }
            50% { opacity: 0.5; box-shadow: 0 0 20px #00d4ff; }
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff6b6b;
            animation: pulse 2s infinite;
        }

        .status-indicator.connected {
            background: #4ecdc4;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #e0e0e0;
            font-size: 0.9rem;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            transition: all 0.3s ease;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.2);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            margin: 5px;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00d4ff, #0099cc);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 212, 255, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(78, 205, 196, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .digit-display {
            text-align: center;
            margin: 20px 0;
            position: relative;
        }

        .current-digit {
            font-size: clamp(4rem, 10vw, 8rem);
            font-weight: 900;
            color: #fff;
            text-shadow: 0 0 30px currentColor;
            position: relative;
        }

        .digit-call {
            color: #4ecdc4;
            animation: glowGreen 1.5s ease-in-out;
        }

        .digit-put {
            color: #ff6b6b;
            animation: glowRed 1.5s ease-in-out;
        }

        @keyframes glowGreen {
            0%, 100% { text-shadow: 0 0 30px #4ecdc4; }
            50% { text-shadow: 0 0 50px #4ecdc4, 0 0 70px #4ecdc4; }
        }

        @keyframes glowRed {
            0%, 100% { text-shadow: 0 0 30px #ff6b6b; }
            50% { text-shadow: 0 0 50px #ff6b6b, 0 0 70px #ff6b6b; }
        }

        .prediction-display {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }

        .prediction-call {
            background: rgba(78, 205, 196, 0.1);
            border-color: rgba(78, 205, 196, 0.3);
        }

        .prediction-put {
            background: rgba(255, 107, 107, 0.1);
            border-color: rgba(255, 107, 107, 0.3);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-value {
            font-size: clamp(1.4rem, 3vw, 2rem);
            font-weight: bold;
            color: #00d4ff;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #a0a0a0;
            margin-top: 5px;
        }

        .ai-section {
            border-top: 2px solid rgba(0, 212, 255, 0.3);
            padding-top: 20px;
            margin-top: 20px;
        }

        .ai-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.2);
            transition: .4s;
            border-radius: 30px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background: #4ecdc4;
        }

        input:checked + .slider:before {
            transform: translateX(30px);
        }

        .market-analysis {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            padding: 15px;
            border-radius: 15px;
            margin: 15px 0;
        }

        .signal-strength {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }

        .strength-bar {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
        }

        .strength-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #ffa500, #4ecdc4);
            transition: width 0.5s ease;
        }

        .recent-digits {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .recent-digit {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            border: 2px solid transparent;
        }

        .recent-digit.call-signal {
            background: rgba(78, 205, 196, 0.3);
            border-color: #4ecdc4;
            box-shadow: 0 0 15px rgba(78, 205, 196, 0.5);
        }

        .recent-digit.put-signal {
            background: rgba(255, 107, 107, 0.3);
            border-color: #ff6b6b;
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.5);
        }

        .history-section {
            max-height: 500px;
            overflow-y: auto;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            font-size: 0.9rem;
            flex-wrap: wrap;
            gap: 10px;
            border-left: 4px solid transparent;
        }

        .history-item.win {
            border-left-color: #4ecdc4;
            background: rgba(78, 205, 196, 0.1);
        }

        .history-item.loss {
            border-left-color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
        }

        .alert {
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            font-size: 0.9rem;
            border: 1px solid;
        }

        .alert-success {
            background: rgba(78, 205, 196, 0.1);
            border-color: #4ecdc4;
            color: #4ecdc4;
        }

        .alert-error {
            background: rgba(255, 107, 107, 0.1);
            border-color: #ff6b6b;
            color: #ff6b6b;
        }

        .alert-info {
            background: rgba(0, 212, 255, 0.1);
            border-color: #00d4ff;
            color: #00d4ff;
        }

        .ai-brain {
            text-align: center;
            margin: 20px 0;
        }

        .brain-icon {
            font-size: 3rem;
            animation: brainPulse 3s infinite;
        }

        @keyframes brainPulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
        }

        @media (max-width: 480px) {
            .container {
                padding: 5px;
            }
            
            .card {
                padding: 15px;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 12px;
            }
            
            .ai-controls {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .advanced-settings {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
        }

        .risk-meter {
            margin: 15px 0;
        }

        .risk-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            overflow: hidden;
        }

        .risk-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ecdc4, #ffa500, #ff6b6b);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🧠 Zeus AI - Advanced Trading Bot</h1>
            <p>Intelligent Call/Put Prediction System with Advanced Market Analysis</p>
        </div>

        <div class="main-grid">
            <div class="card">
                <div class="ai-status">
                    <div class="ai-indicator"></div>
                    <span><strong>AI Status:</strong> <span id="aiStatus">Initializing Neural Networks...</span></span>
                </div>

                <div class="connection-status">
                    <div class="status-indicator" id="connectionStatus"></div>
                    <span id="connectionText">Disconnected</span>
                    <button class="btn btn-danger" id="disconnectBtn" onclick="disconnect()" style="display: none;">Disconnect</button>
                </div>

                <div class="input-group">
                    <label for="appId">App ID:</label>
                    <input type="text" id="appId" placeholder="Enter your Deriv App ID" value="1089">
                </div>

                <div class="input-group">
                    <label for="apiToken">API Token:</label>
                    <input type="password" id="apiToken" placeholder="Enter your API Token">
                </div>

                <div class="input-group">
                    <label for="marketSelect">Trading Market:</label>
                    <select id="marketSelect">
                        <option value="R_10">Volatility 10 Index (Stable)</option>
                        <option value="R_25">Volatility 25 Index (Low Risk)</option>
                        <option value="R_50">Volatility 50 Index (Balanced)</option>
                        <option value="R_75" selected>Volatility 75 Index (Recommended)</option>
                        <option value="R_100">Volatility 100 Index (High Risk)</option>
                        <option value="1HZ10V">Volatility 10 (1s) - Fast</option>
                        <option value="1HZ25V">Volatility 25 (1s) - Fast</option>
                        <option value="1HZ50V">Volatility 50 (1s) - Fast</option>
                        <option value="1HZ75V">Volatility 75 (1s) - Fast</option>
                        <option value="1HZ100V">Volatility 100 (1s) - Fast</option>
                    </select>
                </div>

                <button class="btn btn-primary" id="connectBtn" onclick="connect()">🚀 Connect & Initialize AI</button>

                <div class="digit-display">
                    <div class="current-digit" id="currentDigit">-</div>
                    <div style="font-size: 1.1rem; color: #a0a0a0; margin-top: 10px;">
                        Current Last Digit
                    </div>
                    <div class="recent-digits" id="recentDigits"></div>
                </div>

                <div class="prediction-display" id="predictionDisplay">
                    <div class="ai-brain">
                        <div class="brain-icon">🧠</div>
                    </div>
                    <div><strong>AI Prediction:</strong> <span id="aiPrediction">Analyzing market patterns...</span></div>
                    <div style="margin-top: 10px;">
                        <strong>Confidence:</strong> <span id="aiConfidence">0%</span> | 
                        <strong>Signal:</strong> <span id="aiSignal">WAIT</span>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="totalTicks">0</div>
                        <div class="stat-label">Total Ticks</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="aiAccuracy">0%</div>
                        <div class="stat-label">AI Accuracy</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="balance">$0.00</div>
                        <div class="stat-label">Balance</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="todayProfit">$0.00</div>
                        <div class="stat-label">Today's P&L</div>
                    </div>
                </div>

                <div class="ai-section">
                    <h3 style="margin-bottom: 20px; color: #00d4ff;">🤖 Advanced AI Trading System</h3>
                    
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
                        <label class="toggle-switch">
                            <input type="checkbox" id="aiTradeToggle" onchange="toggleAITrade()">
                            <span class="slider"></span>
                        </label>
                        <span><strong>AI Auto Trade:</strong> <span id="aiTradeStatus">OFF</span></span>
                    </div>

                    <div class="ai-controls">
                        <div class="input-group">
                            <label for="tradeAmount">Trade Amount ($):</label>
                            <input type="number" id="tradeAmount" value="2" min="0.35" step="0.01">
                        </div>
                        <div class="input-group">
                            <label for="tradeDuration">Duration (ticks):</label>
                            <select id="tradeDuration">
                                <option value="1">1 tick</option>
                                <option value="2">2 ticks</option>
                                <option value="3">3 ticks</option>
                                <option value="5" selected>5 ticks</option>
                                <option value="10">10 ticks</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="aiStrategy">AI Strategy:</label>
                            <select id="aiStrategy" onchange="updateStrategyInfo()">
                                <option value="neural_prediction">Neural Network Prediction</option>
                                <option value="pattern_recognition">Pattern Recognition AI</option>
                                <option value="market_sentiment">Market Sentiment Analysis</option>
                                <option value="volatility_prediction">Volatility Prediction</option>
                                <option value="hybrid_ai">Hybrid AI (All Combined)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="riskLevel">Risk Level:</label>
                            <select id="riskLevel" onchange="updateRiskLevel()">
                                <option value="conservative">Conservative (High Accuracy)</option>
                                <option value="balanced" selected>Balanced (Medium Risk)</option>
                                <option value="aggressive">Aggressive (High Frequency)</option>
                            </select>
                        </div>
                    </div>

                    <div class="advanced-settings">
                        <h4 style="color: #00d4ff; margin-bottom: 15px;">⚙️ Advanced Settings</h4>
                        
                        <div class="input-group">
                            <label for="minConfidence">Minimum AI Confidence (%):</label>
                            <input type="range" id="minConfidence" min="60" max="95" value="75" oninput="updateConfidenceDisplay()">
                            <div style="text-align: center; margin-top: 5px; color: #00d4ff;">
                                <span id="confidenceDisplay">75%</span>
                            </div>
                        </div>

                        <div class="risk-meter">
                            <label>Current Risk Level:</label>
                            <div class="risk-bar">
                                <div class="risk-fill" id="riskFill" style="width: 50%;"></div>
                            </div>
                        </div>

                        <div class="input-group">
                            <label for="maxTrades">Max Trades per Hour:</label>
                            <input type="number" id="maxTrades" value="8" min="1" max="20">
                        </div>

                        <div class="input-group">
                            <label for="stopLoss">Stop Loss ($):</label>
                            <input type="number" id="stopLoss" value="20" min="5" step="1">
                        </div>

                        <div class="input-group">
                            <label for="takeProfit">Take Profit ($):</label>
                            <input type="number" id="takeProfit" value="50" min="10" step="1">
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-success" onclick="placeManualTrade('call')" id="callBtn">📈 Manual CALL</button>
                        <button class="btn btn-danger" onclick="placeManualTrade('put')" id="putBtn">📉 Manual PUT</button>
                        <button class="btn btn-primary" onclick="testAIStrategy()">🧪 Test AI Strategy</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 15px; color: #00d4ff;">📊 Trading History</h3>
                <div class="history-section" id="tradeHistory">
                    <div style="text-align: center; color: #a0a0a0; padding: 20px;">
                        No trades yet - AI is ready to start
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid rgba(0, 212, 255, 0.3);">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="totalTrades">0</div>
                            <div class="stat-label">Total Trades</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="winRate">0%</div>
                            <div class="stat-label">Win Rate</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="totalProfit">$0.00</div>
                            <div class="stat-label">Total P&L</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="bestStreak">0</div>
                            <div class="stat-label">Best Streak</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 15px; color: #00d4ff;">🔬 AI Market Analysis</h3>
                
                <div class="market-analysis">
                    <div style="margin-bottom: 15px;">
                        <strong>Market Trend:</strong> <span id="marketTrend">Analyzing...</span>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong>Volatility:</strong> <span id="marketVolatility">Medium</span>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong>Next Prediction:</strong> <span id="nextPrediction">Calculating...</span>
                    </div>
                    
                    <div class="signal-strength">
                        <span>Signal Strength:</span>
                        <div class="strength-bar">
                            <div class="strength-fill" id="signalStrength" style="width: 0%;"></div>
                        </div>
                        <span id="strengthPercent">0%</span>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <h4 style="color: #00d4ff; margin-bottom: 15px;">📈 Pattern Analysis</h4>
                    <div id="patternAnalysis" style="font-family: monospace; font-size: 1.1rem; text-align: center; padding: 15px; background: rgba(0, 0, 0, 0.3); border-radius: 10px;">
                        Waiting for data...
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <h4 style="color: #00d4ff; margin-bottom: 15px;">🎯 AI Recommendations</h4>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="callProbability">0%</div>
                            <div class="stat-label">CALL Probability</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="putProbability">0%</div>
                            <div class="stat-label">PUT Probability</div>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <h4 style="color: #00d4ff; margin-bottom: 15px;">⚡ Real-time Signals</h4>
                    <div id="realTimeSignals" style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 10px; min-height: 100px;">
                        <div style="text-align: center; color: #a0a0a0;">
                            Connect to start receiving AI signals
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="alertContainer"></div>
    </div>

    <script>
        let derivWs = null;
        let isConnected = false;
        let aiTradeEnabled = false;
        let tickCount = 0;
        let tradeHistory = [];
        let currentBalance = 0;
        let tradesThisHour = 0;
        let lastTradeTime = 0;
        let isTrading = false;
        let recentDigits = [];
        let currentMarket = 'R_75';
        let tickHistory = [];
        let aiPredictions = [];
        let correctPredictions = 0;
        let totalPredictions = 0;
        let todayProfit = 0;
        let bestStreak = 0;
        let currentStreak = 0;
        let lastSignal = null;
        let signalHistory = [];

        // Advanced AI variables
        let neuralNetwork = {
            weights: [],
            biases: [],
            learningRate: 0.01
        };

        let marketSentiment = {
            bullish: 0,
            bearish: 0,
            neutral: 0
        };

        let volatilityIndex = 0;
        let trendStrength = 0;

        // Initialize AI system
        function initializeAI() {
            document.getElementById('aiStatus').textContent = 'Neural networks initialized, pattern recognition active';
            
            // Initialize neural network weights (simplified)
            neuralNetwork.weights = Array(20).fill().map(() => Math.random() * 2 - 1);
            neuralNetwork.biases = Array(5).fill().map(() => Math.random() * 2 - 1);
            
            showAlert('🧠 AI System initialized successfully!', 'success');
        }

        // Reset hourly trade counter
        setInterval(() => {
            tradesThisHour = 0;
        }, 3600000);

        function showAlert(message, type = 'info') {
            const alertContainer = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alertContainer.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        function connect() {
            const appId = document.getElementById('appId').value;
            const apiToken = document.getElementById('apiToken').value;
            currentMarket = document.getElementById('marketSelect').value;

            if (!appId || !apiToken) {
                showAlert('Please enter both App ID and API Token', 'error');
                return;
            }

            try {
                derivWs = new WebSocket(`wss://ws.binaryws.com/websockets/v3?app_id=${appId}`);
                
                derivWs.onopen = function() {
                    console.log('Connected to Deriv WebSocket');
                    
                    derivWs.send(JSON.stringify({
                        authorize: apiToken
                    }));
                };

                derivWs.onmessage = function(event) {
                    const data = JSON.parse(event.data);
                    console.log('Deriv message:', data);
                    
                    if (data.msg_type === 'authorize') {
                        if (data.error) {
                            showAlert(`Authorization failed: ${data.error.message}`, 'error');
                            return;
                        }
                        
                        isConnected = true;
                        currentBalance = data.authorize.balance;
                        updateConnectionStatus();
                        updateBalance();
                        initializeAI();
                        showAlert(`🚀 Connected to ${currentMarket}! AI system activated.`, 'success');
                        
                        // Subscribe to tick stream
                        derivWs.send(JSON.stringify({
                            ticks: currentMarket,
                            subscribe: 1
                        }));
                        
                        // Get account balance
                        derivWs.send(JSON.stringify({
                            balance: 1,
                            subscribe: 1
                        }));
                    }
                    
                    if (data.msg_type === 'tick') {
                        handleTick(data.tick);
                    }
                    
                    if (data.msg_type === 'balance') {
                        currentBalance = data.balance.balance;
                        updateBalance();
                    }
                    
                    if (data.msg_type === 'buy') {
                        handleTradeResult(data);
                    }
                    
                    if (data.msg_type === 'proposal_open_contract') {
                        handleContractUpdate(data);
                    }
                };

                derivWs.onerror = function(error) {
                    console.error('Deriv WebSocket error:', error);
                    showAlert('Connection error occurred', 'error');
                };

                derivWs.onclose = function() {
                    console.log('Deriv WebSocket closed');
                    isConnected = false;
                    updateConnectionStatus();
                    showAlert('Disconnected from Deriv', 'info');
                };

            } catch (error) {
                console.error('Connection error:', error);
                showAlert('Failed to connect to Deriv', 'error');
            }
        }

        function disconnect() {
            if (derivWs) {
                derivWs.close();
            }
            isConnected = false;
            aiTradeEnabled = false;
            document.getElementById('aiTradeToggle').checked = false;
            updateConnectionStatus();
            updateAITradeStatus();
            showAlert('Disconnected from Deriv', 'info');
        }

        function handleTick(tick) {
            const tickQuote = tick.quote.toString();
            const lastDigit = parseInt(tickQuote.slice(-1));
            
            // Store comprehensive tick data
            const tickData = {
                digit: lastDigit,
                quote: tick.quote,
                time: new Date(tick.epoch * 1000),
                epoch: tick.epoch
            };
            
            tickHistory.push(tickData);
            
            // Keep last 200 ticks for advanced analysis
            if (tickHistory.length > 200) {
                tickHistory.shift();
            }
            
            tickCount++;
            
            // Update recent digits
            recentDigits.unshift(lastDigit);
            if (recentDigits.length > 50) {
                recentDigits.pop();
            }
            
            // Run AI analysis
            runAIAnalysis(tickData);
            
            // Update UI
            updateDigitDisplay(lastDigit);
            updateRecentDigits();
            updateStats();
            updateMarketAnalysis();
            
            // Check for AI trading opportunity
            if (aiTradeEnabled && shouldAITrade()) {
                setTimeout(() => executeAITrade(), 500);
            }
        }

        function runAIAnalysis(tickData) {
            if (tickHistory.length < 20) return;
            
            // Neural Network Prediction
            const prediction = neuralNetworkPredict();
            
            // Pattern Recognition
            const pattern = recognizePattern();
            
            // Market Sentiment Analysis
            updateMarketSentiment();
            
            // Volatility Analysis
            calculateVolatility();
            
            // Generate AI prediction
            const aiPrediction = generateAIPrediction(prediction, pattern);
            
            // Update AI display
            updateAIPrediction(aiPrediction);
            
            // Store prediction for accuracy tracking
            if (lastSignal) {
                checkPredictionAccuracy(tickData.digit);
            }
            
            lastSignal = aiPrediction;
        }

        function neuralNetworkPredict() {
            if (recentDigits.length < 10) return { call: 0.5, put: 0.5 };
            
            // Simplified neural network calculation
            const inputs = recentDigits.slice(0, 10).map(d => d / 9); // Normalize
            let callScore = 0;
            let putScore = 0;
            
            for (let i = 0; i < inputs.length; i++) {
                callScore += inputs[i] * neuralNetwork.weights[i];
                putScore += inputs[i] * neuralNetwork.weights[i + 10];
            }
            
            // Apply activation function (sigmoid)
            callScore = 1 / (1 + Math.exp(-callScore));
            putScore = 1 / (1 + Math.exp(-putScore));
            
            // Normalize to sum to 1
            const total = callScore + putScore;
            return {
                call: callScore / total,
                put: putScore / total
            };
        }

        function recognizePattern() {
            if (recentDigits.length < 15) return { strength: 0, direction: 'neutral' };
            
            const last15 = recentDigits.slice(0, 15);
            
            // Detect trends
            let upTrend = 0;
            let downTrend = 0;
            
            for (let i = 1; i < last15.length; i++) {
                if (last15[i] > last15[i-1]) upTrend++;
                if (last15[i] < last15[i-1]) downTrend++;
            }
            
            // Detect patterns
            const consecutiveHigh = last15.slice(0, 5).filter(d => d > 4).length;
            const consecutiveLow = last15.slice(0, 5).filter(d => d < 5).length;
            
            let strength = 0;
            let direction = 'neutral';
            
            if (consecutiveHigh >= 4) {
                strength = 0.8;
                direction = 'put'; // Expect reversal
            } else if (consecutiveLow >= 4) {
                strength = 0.8;
                direction = 'call'; // Expect reversal
            } else if (upTrend > downTrend * 1.5) {
                strength = 0.6;
                direction = 'call';
            } else if (downTrend > upTrend * 1.5) {
                strength = 0.6;
                direction = 'put';
            }
            
            return { strength, direction };
        }

        function updateMarketSentiment() {
            if (recentDigits.length < 20) return;
            
            const last20 = recentDigits.slice(0, 20);
            const highDigits = last20.filter(d => d > 6).length;
            const lowDigits = last20.filter(d => d < 3).length;
            const midDigits = last20.filter(d => d >= 3 && d <= 6).length;
            
            marketSentiment.bullish = highDigits / 20;
            marketSentiment.bearish = lowDigits / 20;
            marketSentiment.neutral = midDigits / 20;
        }

        function calculateVolatility() {
            if (tickHistory.length < 10) return;
            
            const last10Quotes = tickHistory.slice(-10).map(t => t.quote);
            const changes = [];
            
            for (let i = 1; i < last10Quotes.length; i++) {
                changes.push(Math.abs(last10Quotes[i] - last10Quotes[i-1]));
            }
            
            const avgChange = changes.reduce((a, b) => a + b, 0) / changes.length;
            volatilityIndex = Math.min(avgChange * 100, 100);
        }

        function generateAIPrediction(neuralPred, pattern) {
            const strategy = document.getElementById('aiStrategy').value;
            const riskLevel = document.getElementById('riskLevel').value;
            
            let callProb = neuralPred.call;
            let putProb = neuralPred.put;
            
            // Adjust based on pattern
            if (pattern.direction === 'call') {
                callProb += pattern.strength * 0.3;
            } else if (pattern.direction === 'put') {
                putProb += pattern.strength * 0.3;
            }
            
            // Adjust based on market sentiment
            callProb += marketSentiment.bullish * 0.2;
            putProb += marketSentiment.bearish * 0.2;
            
            // Adjust based on volatility
            if (volatilityIndex > 50) {
                // High volatility - more extreme predictions
                if (callProb > putProb) {
                    callProb += 0.1;
                } else {
                    putProb += 0.1;
                }
            }
            
            // Normalize
            const total = callProb + putProb;
            callProb = callProb / total;
            putProb = putProb / total;
            
            // Determine confidence and signal
            const confidence = Math.abs(callProb - putProb) * 100;
            const minConfidence = parseInt(document.getElementById('minConfidence').value);
            
            let signal = 'WAIT';
            let direction = null;
            
            if (confidence >= minConfidence) {
                if (callProb > putProb) {
                    signal = 'CALL';
                    direction = 'call';
                } else {
                    signal = 'PUT';
                    direction = 'put';
                }
            }
            
            return {
                callProb: Math.round(callProb * 100),
                putProb: Math.round(putProb * 100),
                confidence: Math.round(confidence),
                signal,
                direction
            };
        }

        function updateAIPrediction(prediction) {
            document.getElementById('aiPrediction').textContent = 
                `${prediction.signal} - ${prediction.confidence}% confidence`;
            document.getElementById('aiConfidence').textContent = `${prediction.confidence}%`;
            document.getElementById('aiSignal').textContent = prediction.signal;
            
            document.getElementById('callProbability').textContent = `${prediction.callProb}%`;
            document.getElementById('putProbability').textContent = `${prediction.putProb}%`;
            
            // Update prediction display styling
            const predDisplay = document.getElementById('predictionDisplay');
            predDisplay.className = 'prediction-display';
            
            if (prediction.signal === 'CALL') {
                predDisplay.classList.add('prediction-call');
            } else if (prediction.signal === 'PUT') {
                predDisplay.classList.add('prediction-put');
            }
            
            // Update signal strength bar
            document.getElementById('signalStrength').style.width = `${prediction.confidence}%`;
            document.getElementById('strengthPercent').textContent = `${prediction.confidence}%`;
            
            // Add to real-time signals
            addRealTimeSignal(prediction);
        }

        function addRealTimeSignal(prediction) {
            const signalsContainer = document.getElementById('realTimeSignals');
            const time = new Date().toLocaleTimeString();
            
            const signalElement = document.createElement('div');
            signalElement.style.cssText = `
                padding: 8px;
                margin: 5px 0;
                border-radius: 8px;
                font-size: 0.9rem;
                background: rgba(255, 255, 255, 0.1);
                border-left: 4px solid ${prediction.signal === 'CALL' ? '#4ecdc4' : prediction.signal === 'PUT' ? '#ff6b6b' : '#00d4ff'};
            `;
            
            signalElement.innerHTML = `
                <strong>${time}</strong> - ${prediction.signal} 
                (${prediction.confidence}% confidence)
            `;
            
            signalsContainer.insertBefore(signalElement, signalsContainer.firstChild);
            
            // Keep only last 10 signals
            while (signalsContainer.children.length > 10) {
                signalsContainer.removeChild(signalsContainer.lastChild);
            }
        }

        function shouldAITrade() {
            if (!lastSignal || lastSignal.signal === 'WAIT') return false;
            
            const maxTrades = parseInt(document.getElementById('maxTrades').value);
            const now = Date.now();
            
            if (tradesThisHour >= maxTrades || now - lastTradeTime < 30000 || isTrading) {
                return false;
            }
            
            // Check stop loss and take profit
            if (todayProfit <= -parseInt(document.getElementById('stopLoss').value)) {
                showAlert('🛑 Stop loss reached for today', 'error');
                return false;
            }
            
            if (todayProfit >= parseInt(document.getElementById('takeProfit').value)) {
                showAlert('🎯 Take profit reached for today', 'success');
                return false;
            }
            
            return true;
        }

        function executeAITrade() {
            if (!lastSignal || !lastSignal.direction) return;
            
            const amount = parseFloat(document.getElementById('tradeAmount').value);
            const duration = parseInt(document.getElementById('tradeDuration').value);
            
            if (amount > currentBalance) {
                showAlert('Insufficient balance for AI trade', 'error');
                return;
            }
            
            placeTrade(lastSignal.direction, amount, duration, true);
        }

        function placeManualTrade(direction) {
            const amount = parseFloat(document.getElementById('tradeAmount').value);
            const duration = parseInt(document.getElementById('tradeDuration').value);
            
            placeTrade(direction, amount, duration, false);
        }

        function placeTrade(direction, amount, duration, isAI = false) {
            if (!isConnected) {
                showAlert('Please connect to Deriv first', 'error');
                return;
            }
            
            if (isTrading) {
                showAlert('Trade already in progress', 'error');
                return;
            }
            
            if (amount < 0.35) {
                showAlert('Minimum trade amount is $0.35', 'error');
                return;
            }
            
            if (amount > currentBalance) {
                showAlert('Insufficient balance', 'error');
                return;
            }
            
            isTrading = true;
            lastTradeTime = Date.now();
            tradesThisHour++;
            
            // Determine contract type
            let contractType;
            if (direction === 'call') {
                contractType = 'CALL';
            } else {
                contractType = 'PUT';
            }
            
            const proposalRequest = {
                proposal: 1,
                amount: amount,
                basis: 'stake',
                contract_type: contractType,
                currency: 'USD',
                duration: duration,
                duration_unit: 't',
                symbol: currentMarket
            };
            
            console.log('Sending proposal:', proposalRequest);
            derivWs.send(JSON.stringify(proposalRequest));
            
            const originalOnMessage = derivWs.onmessage;
            derivWs.onmessage = function(event) {
                const data = JSON.parse(event.data);
                
                if (data.msg_type === 'proposal') {
                    if (data.error) {
                        showAlert(`Trade proposal failed: ${data.error.message}`, 'error');
                        isTrading = false;
                        derivWs.onmessage = originalOnMessage;
                        return;
                    }
                    
                    const buyRequest = {
                        buy: data.proposal.id,
                        price: amount
                    };
                    
                    console.log('Buying contract:', buyRequest);
                    derivWs.send(JSON.stringify(buyRequest));
                }
                
                if (data.msg_type === 'buy') {
                    if (data.error) {
                        showAlert(`Trade failed: ${data.error.message}`, 'error');
                        isTrading = false;
                    } else {
                        const tradeType = isAI ? `AI ${direction.toUpperCase()}` : `Manual ${direction.toUpperCase()}`;
                        showAlert(`${tradeType} trade placed! Contract: ${data.buy.contract_id}`, 'success');
                        
                        derivWs.send(JSON.stringify({
                            proposal_open_contract: 1,
                            contract_id: data.buy.contract_id,
                            subscribe: 1
                        }));
                        
                        const trade = {
                            id: data.buy.contract_id,
                            type: tradeType,
                            direction: direction,
                            amount: amount,
                            time: new Date().toLocaleTimeString(),
                            status: 'open',
                            isAI: isAI,
                            market: currentMarket,
                            confidence: lastSignal ? lastSignal.confidence : 0
                        };
                        
                        tradeHistory.unshift(trade);
                        updateTradeHistory();
                    }
                    
                    derivWs.onmessage = originalOnMessage;
                }
                
                originalOnMessage(event);
            };
        }

        function handleContractUpdate(data) {
            if (data.proposal_open_contract) {
                const contract = data.proposal_open_contract;
                
                const tradeIndex = tradeHistory.findIndex(t => t.id === contract.contract_id);
                if (tradeIndex !== -1) {
                    const trade = tradeHistory[tradeIndex];
                    
                    if (contract.is_sold) {
                        trade.status = contract.profit > 0 ? 'win' : 'loss';
                        trade.profit = contract.profit;
                        trade.payout = contract.payout;
                        isTrading = false;
                        
                        // Update profit tracking
                        todayProfit += contract.profit;
                        
                        // Update streak
                        if (contract.profit > 0) {
                            currentStreak++;
                            if (currentStreak > bestStreak) {
                                bestStreak = currentStreak;
                            }
                        } else {
                            currentStreak = 0;
                        }
                        
                        // Update AI accuracy if it was an AI trade
                        if (trade.isAI) {
                            totalPredictions++;
                            if (contract.profit > 0) {
                                correctPredictions++;
                            }
                            
                            // Update neural network weights (simplified learning)
                            updateNeuralNetwork(contract.profit > 0);
                        }
                        
                        updateTradeHistory();
                        updateTradeStats();
                        
                        const message = contract.profit > 0 
                            ? `🎉 ${trade.type} WON! Profit: $${contract.profit.toFixed(2)}`
                            : `😞 ${trade.type} LOST. Loss: $${Math.abs(contract.profit).toFixed(2)}`;
                        
                        showAlert(message, contract.profit > 0 ? 'success' : 'error');
                    }
                }
            }
        }

        function updateNeuralNetwork(won) {
            // Simplified neural network learning
            const learningRate = neuralNetwork.learningRate;
            const adjustment = won ? learningRate : -learningRate;
            
            for (let i = 0; i < neuralNetwork.weights.length; i++) {
                neuralNetwork.weights[i] += adjustment * (Math.random() - 0.5);
            }
        }

        function checkPredictionAccuracy(actualDigit) {
            // This is a simplified accuracy check
            // In a real implementation, you'd track specific predictions vs outcomes
        }

        function testAIStrategy() {
            if (!isConnected) {
                showAlert('Please connect to Deriv first', 'error');
                return;
            }
            
            // Simulate AI strategy test
            const testResult = Math.random() > 0.3; // 70% win rate for testing
            const testTrade = {
                id: 'TEST_' + Date.now(),
                type: 'AI Test',
                direction: Math.random() > 0.5 ? 'call' : 'put',
                amount: 1.00,
                time: new Date().toLocaleTimeString(),
                status: testResult ? 'win' : 'loss',
                profit: testResult ? 0.85 : -1.00,
                isAI: true,
                market: currentMarket,
                confidence: Math.floor(Math.random() * 40) + 60
            };
            
            tradeHistory.unshift(testTrade);
            updateTradeHistory();
            updateTradeStats();
            showAlert(`AI Strategy test completed - ${testTrade.status.toUpperCase()}`, 'info');
        }

        function toggleAITrade() {
            const toggle = document.getElementById('aiTradeToggle');
            aiTradeEnabled = toggle.checked;
            updateAITradeStatus();
            
            if (aiTradeEnabled && !isConnected) {
                showAlert('Please connect to Deriv first', 'error');
                toggle.checked = false;
                aiTradeEnabled = false;
                updateAITradeStatus();
                return;
            }
            
            const message = aiTradeEnabled 
                ? '🤖 AI Auto Trading activated! The bot will now trade based on AI predictions.' 
                : '⏹️ AI Auto Trading deactivated';
            showAlert(message, aiTradeEnabled ? 'success' : 'info');
        }

        function updateStrategyInfo() {
            // Strategy info is now displayed in the AI analysis panel
        }

        function updateConfidenceDisplay() {
            const confidence = document.getElementById('minConfidence').value;
            document.getElementById('confidenceDisplay').textContent = confidence + '%';
        }

        function updateRiskLevel() {
            const riskLevel = document.getElementById('riskLevel').value;
            const riskFill = document.getElementById('riskFill');
            
            switch (riskLevel) {
                case 'conservative':
                    riskFill.style.width = '30%';
                    break;
                case 'balanced':
                    riskFill.style.width = '60%';
                    break;
                case 'aggressive':
                    riskFill.style.width = '90%';
                    break;
            }
        }

        function updateDigitDisplay(digit) {
            const digitElement = document.getElementById('currentDigit');
            digitElement.textContent = digit;
            
            // Remove all classes
            digitElement.className = 'current-digit';
            
            // Add appropriate class based on last signal
            if (lastSignal && lastSignal.signal === 'CALL') {
                digitElement.classList.add('digit-call');
            } else if (lastSignal && lastSignal.signal === 'PUT') {
                digitElement.classList.add('digit-put');
            }
        }

        function updateRecentDigits() {
            const container = document.getElementById('recentDigits');
            container.innerHTML = recentDigits.slice(0, 15).map((digit, index) => {
                let classes = 'recent-digit';
                
                // Highlight based on AI signals
                if (signalHistory[index]) {
                    if (signalHistory[index].signal === 'CALL') {
                        classes += ' call-signal';
                    } else if (signalHistory[index].signal === 'PUT') {
                        classes += ' put-signal';
                    }
                }
                
                return `<div class="${classes}">${digit}</div>`;
            }).join('');
            
            // Update pattern analysis
            document.getElementById('patternAnalysis').textContent = 
                recentDigits.slice(0, 20).join(' ');
        }

        function updateMarketAnalysis() {
            // Update market trend
            const trend = calculateTrend();
            document.getElementById('marketTrend').textContent = trend;
            
            // Update volatility display
            let volText = 'Low';
            if (volatilityIndex > 70) volText = 'Very High';
            else if (volatilityIndex > 50) volText = 'High';
            else if (volatilityIndex > 30) volText = 'Medium';
            
            document.getElementById('marketVolatility').textContent = volText;
            
            // Update next prediction
            if (lastSignal) {
                document.getElementById('nextPrediction').textContent = 
                    `${lastSignal.signal} (${lastSignal.confidence}% confidence)`;
            }
        }

        function calculateTrend() {
            if (recentDigits.length < 10) return 'Insufficient data';
            
            const last10 = recentDigits.slice(0, 10);
            const avg = last10.reduce((a, b) => a + b, 0) / 10;
            
            if (avg > 5.5) return 'Bullish (High digits)';
            if (avg < 3.5) return 'Bearish (Low digits)';
            return 'Neutral (Balanced)';
        }

        function updateConnectionStatus() {
            const statusIndicator = document.getElementById('connectionStatus');
            const statusText = document.getElementById('connectionText');
            const connectBtn = document.getElementById('connectBtn');
            const disconnectBtn = document.getElementById('disconnectBtn');
            
            if (isConnected) {
                statusIndicator.classList.add('connected');
                statusText.textContent = `Connected to ${currentMarket}`;
                connectBtn.style.display = 'none';
                disconnectBtn.style.display = 'inline-block';
            } else {
                statusIndicator.classList.remove('connected');
                statusText.textContent = 'Disconnected';
                connectBtn.style.display = 'inline-block';
                disconnectBtn.style.display = 'none';
            }
        }

        function updateAITradeStatus() {
            document.getElementById('aiTradeStatus').textContent = aiTradeEnabled ? 'ON' : 'OFF';
        }

        function updateStats() {
            document.getElementById('totalTicks').textContent = tickCount;
            
            // Update AI accuracy
            const accuracy = totalPredictions > 0 ? 
                Math.round((correctPredictions / totalPredictions) * 100) : 0;
            document.getElementById('aiAccuracy').textContent = accuracy + '%';
            
            document.getElementById('todayProfit').textContent = '$' + todayProfit.toFixed(2);
        }

        function updateBalance() {
            document.getElementById('balance').textContent = '$' + currentBalance.toFixed(2);
        }

        function updateTradeHistory() {
            const historyContainer = document.getElementById('tradeHistory');
            
            if (tradeHistory.length === 0) {
                historyContainer.innerHTML = '<div style="text-align: center; color: #a0a0a0; padding: 20px;">No trades yet - AI is ready to start</div>';
                return;
            }
            
            historyContainer.innerHTML = tradeHistory.slice(0, 20).map(trade => `
                <div class="history-item ${trade.status}">
                    <div>
                        <strong>${trade.type}</strong>
                        ${trade.isAI ? '🧠' : '👤'}
                        ${trade.confidence ? `(${trade.confidence}%)` : ''}
                        <br>
                        <small>${trade.time} • ${trade.market}</small>
                    </div>
                    <div>
                        $${trade.amount.toFixed(2)}
                        <br>
                        <small style="color: ${trade.status === 'win' ? '#4ecdc4' : trade.status === 'loss' ? '#ff6b6b' : '#a0a0a0'}">
                            ${trade.status === 'open' ? 'OPEN' : 
                              trade.status === 'win' ? `+$${trade.profit.toFixed(2)}` : 
                              trade.status === 'loss' ? `$${trade.profit.toFixed(2)}` : 'PENDING'}
                        </small>
                    </div>
                </div>
            `).join('');
        }

        function updateTradeStats() {
            const completedTrades = tradeHistory.filter(t => t.status === 'win' || t.status === 'loss');
            const wins = tradeHistory.filter(t => t.status === 'win').length;
            const winRate = completedTrades.length > 0 ? ((wins / completedTrades.length) * 100).toFixed(1) : 0;
            const totalProfit = tradeHistory.reduce((sum, trade) => {
                return sum + (trade.profit || 0);
            }, 0);
            
            document.getElementById('totalTrades').textContent = completedTrades.length;
            document.getElementById('winRate').textContent = winRate + '%';
            document.getElementById('totalProfit').textContent = '$' + totalProfit.toFixed(2);
            document.getElementById('bestStreak').textContent = bestStreak;
        }

        // Initialize
        updateConnectionStatus();
        updateAITradeStatus();
        updateStats();
        updateBalance();
        updateRiskLevel();
        updateConfidenceDisplay();
    </script>
</body>
</html>